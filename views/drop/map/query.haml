%nav.navbar.navbar-inverse.navbar-fixed-top
  %div.container
    %div.navbar-header
      %button.navbar-toggle.collapsed{:type => "button",
                                      :"data-toggle" => "collapse",
                                      :"data-target" => "#navbar-main",
                                      :"aria-expanded" => "false"}
        %span.sr-only 展开导航栏
        %span.icon-bar
        %span.icon-bar
        %span.icon-bar
      %a.navbar-brand{:href => "/"} poi-statistics
    %div#navbar-main.navbar-collapse.collapse
      %ul.nav.navbar-nav
        %li.active
          %a{:href => "/drop"} 掉落统计
%div.container
  %div.row.row-offcanvas.row-offcanvas-right
    %div.col-xs-12.col-sm-9
      %p.pull-right.visible-xs
        %button.btn.btn-primary.btn-xs{:type => "button", :"data-toggle" => "offcanvas"}
          展开侧边栏
      %ol.breadcrumb
        %li 主页
        %li 掉落
        %li= KCConstants.areas[map_id / 10]
        %li= KCConstants.maps[map_id]
      %ul#cells.nav.nav-pills{:role => "tablist"}
        - enemy_hash = KCConstants.cells[map_id].invert
        - enemy_hash.each do |c_name, c_id|
          %li{:role => "presentation", :class => c_name.include?("(Boss)") ? "active" : nil}
            %a{:"aria-controls" => "point#{c_id}",
               :"data-toggle" => "pill",
               :href => "#point#{c_id}",
               :role => "tab"}= c_name
      %div
        %img.drop-map{:src => SiteConstants.map_images[map_id]}
      %div.tab-content.hidden
        - enemy_hash.each do |c_name, c_id|
          %div{:class => "tab-pane#{c_name.include?("(Boss)") ? " active" : ""}",
               :id => "point#{c_id}",
               :role => "tabpanel"}
            %div{:id => "toolbar#{c_id}"}
              %div.toolbar-content
                %span= "最后更新时间: #{Time.now}"
            %table.table.table-hover.table-striped{:"data-eneny-name" => c_name,
                                                   :"data-sort-name" => "dropRate",
                                                   :"data-toolbar" => "#toolbar#{c_id}",
                                                   :"data-search" => "true",
                                                   :"data-show-columns" => "true",
                                                   :"data-show-export" => "true",
                                                   :"data-detail-view" => "true",
                                                   :"data-detail-formatter" => "detailFormatter"}
              %thead
                %tr
                  %th{:"data-field" => "name",
                      :"data-formatter" => "nameFormatter",
                      :"data-switchable" => "false"} 舰娘
                  %th{:"data-field" => "type"} 舰种
                  %th{:"data-field" => "totalCount"} 数量
                  %th{:"data-field" => "sCount",
                      :"data-sortable" => "true"} S胜
                  %th{:"data-field" => "aCount",
                      :"data-sortable" => "true"} A胜
                  %th{:"data-field" => "bCount",
                      :"data-sortable" => "true"} B胜
                  %th{:"data-field" => "hqLvRange"} 提督等级
                  %th{:"data-field" => "dropRate",
                      :"data-sortable" => "true"} 掉落率
      %div.busy-indicator
        %span.glyphicon.glyphicon-refresh.glyphicon-spin
        %span 少女祈祷中...
    %div#sidebar.class.col-xs-6.col-sm-3.sidebar-offcanvas
      %div#accordion.panel-group
        - KCConstants.areas.each do |a_id, a_name|
          %div.panel.panel-default
            %div.panel-heading
              %h4.panel-title
                %a{:"data-toggle" => "collapse",
                   :"data-parent" => "#accordion",
                   :href => "#map#{a_id}"}= "#{a_name} (#{a_id})"
            %div{:id => "map#{a_id}",
                 :class => "panel-collapse collapse #{map_id / 10 == a_id ? ' in' : ''}"}
              %div.list-group
                - KCConstants.maps.select{|k, v| k / 10 == a_id}.each do |m_id, m_name|
                  %a{:class => "list-group-item#{map_id == m_id ? ' active' : ''}",
                     :href => "/drop/map/#{m_name}.html"}= "#{m_name} (#{m_id / 10}-#{m_id % 10})"
%script{:src => "/scripts/drop_map.js", :defer => "defer"}
%script{:defer => "defer"}
  :plain
    $(document).ready(function() {
      requestData("#{KCConstants.maps[map_id]}");
    });
